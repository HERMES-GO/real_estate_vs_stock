<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì„œìš¸ ìê°€ vs ì›”ì„¸+íˆ¬ì ì‹œë®¬ë ˆì´í„°</title>
<style>
  :root {
    --bg: #0b0f14; --card:#121823; --muted:#7f8ea3; --text:#e6edf6; --accent:#6aa1ff; --ok:#2ecc71; --bad:#ff6b6b; --warn:#ffb020;
  }
  * { box-sizing: border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--text); }
  header { padding: 20px 16px; border-bottom:1px solid #223046; background: linear-gradient(180deg, #0b1220, #0b0f14); position: sticky; top:0; z-index:3; }
  h1 { margin:0 0 6px 0; font-size: 22px; letter-spacing: 0.2px; }
  .sub { color: var(--muted); font-size: 13px; }
  main { max-width: 1200px; margin: 0 auto; padding: 20px 16px 64px; }
  .grid { display:grid; grid-template-columns: 1.1fr 1fr; gap:16px; align-items:start; }
  .card { background:var(--card); border:1px solid #223046; border-radius:14px; padding:16px; box-shadow: 0 8px 24px rgba(0,0,0,.25); }
  .card h2 { margin:0 0 12px 0; font-size:18px; }
  fieldset { border:0; padding:0; margin:0; }
  .row { display:grid; grid-template-columns: 1.2fr 1fr 1fr; gap:10px; margin-bottom:10px; align-items:center; }
  .row.triple-input { grid-template-columns: 1.8fr 0.6fr 0.6fr 0.6fr; }
  .row > label { color:var(--muted); font-size:13px; }
  .row input, .row select { width:100%; padding:8px 10px; border-radius:10px; border:1px solid #314158; background:#0f151f; color:var(--text); font-size:14px; }
  .row.triple-input input { padding:6px 8px; font-size:13px; }
  .row-checkbox { display:flex; gap:10px; align-items:center; margin:6px 0 10px; font-size:13px; color:var(--muted); }
  .muted { color:var(--muted); font-size:12px; }
  .pill { display:inline-block; padding:3px 8px; border:1px solid #314158; border-radius:999px; color:var(--muted); font-size:12px; }
  table { width:100%; border-collapse: collapse; font-size:14px; }
  th, td { padding:10px 8px; border-bottom: 1px solid #223046; text-align:right; }
  th:first-child, td:first-child { text-align:left; }
  thead th { position:sticky; top:0; background:#0f1725; z-index:1; }
  .good { color: var(--ok); }
  .bad { color: var(--bad); }
  .mono { font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1; }
  .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
  .footer-note { color:var(--muted); font-size:12px; margin-top:12px; }
  .btn { background: #17243a; color: var(--text); border:1px solid #314158; padding:8px 10px; border-radius:10px; cursor:pointer; }
  .btn:hover { filter: brightness(1.1); }
  .collapsible-header { background: #17243a; border:1px solid #314158; border-radius:10px; padding:12px 16px; margin:16px 0 8px 0; cursor:pointer; display:flex; justify-content:space-between; align-items:center; }
  .collapsible-header:hover { filter: brightness(1.1); }
  .collapsible-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
  .collapsible-content.expanded { max-height: 1000px; }
  .chevron { transition: transform 0.3s ease; }
  .chevron.rotated { transform: rotate(180deg); }
  .tooltip { position: relative; cursor: help; }
  .tooltip::after { content: attr(data-tooltip); position: absolute; top: 100%; left: 0; background: #1a1f2e; color: var(--text); padding: 8px 12px; border-radius: 6px; font-size: 12px; white-space: nowrap; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.2s, visibility 0.2s; border: 1px solid #314158; box-shadow: 0 4px 12px rgba(0,0,0,0.3); max-width: 300px; white-space: normal; line-height: 1.4; }
  .tooltip:hover::after { opacity: 1; visibility: visible; }
  .scenario-results { gap: 24px; }
  .scenario-group { margin-bottom: 32px; }
  .scenario-title { color: var(--text); font-size: 16px; font-weight: 600; margin: 0 0 12px 0; padding: 12px 16px; background: #17243a; border-radius: 8px; border: 1px solid #314158; }
  .scenario-table { margin-bottom: 16px; }
  .summary-title { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
  .summary-subtitle { font-size: 14px; color: var(--muted); margin-bottom: 16px; }
  .summary-comparison { background: #17243a; border: 1px solid #314158; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
  .summary-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #223046; }
  .summary-row:last-of-type { border-bottom: none; }
  .summary-row.result-row { border-top: 2px solid #314158; padding-top: 12px; margin-top: 8px; font-weight: 600; }
  .summary-row .label { color: var(--muted); font-size: 14px; }
  .summary-row .value { color: var(--text); font-size: 16px; font-variant-numeric: tabular-nums; }
  .summary-row .value.difference { font-size: 18px; font-weight: 700; }
  .summary-conclusion { text-align: center; margin-top: 12px; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 14px; }
  .winner-invest { background: rgba(46, 204, 113, 0.1); color: #2ecc71; border: 1px solid rgba(46, 204, 113, 0.3); }
  .winner-buy { background: rgba(255, 107, 107, 0.1); color: #ff6b6b; border: 1px solid rgba(255, 107, 107, 0.3); }
  .summary-details { display: grid; gap: 8px; }
  .detail-item { font-size: 13px; color: var(--muted); padding: 8px 12px; background: #0f1725; border-radius: 6px; border: 1px solid #223046; }
  
  /* ëª¨ë°”ì¼ í…Œì´ë¸” ìŠ¤íƒ€ì¼ - ë” í° breakpointë„ í¬í•¨ */
  @media screen and (max-width: 768px), screen and (max-width: 1024px) and (orientation: portrait) {
    /* ê¸°ë³¸ í…Œì´ë¸”ì„ ìˆ¨ê¸°ê³  ì¹´ë“œ í˜•íƒœë¡œ ë³€ê²½ */
    .scenario-table thead { display: none !important; }
    .scenario-table, .scenario-table tbody, .scenario-table tr { display: block !important; }
    .scenario-table tr { 
      background: #17243a !important; 
      border: 1px solid #314158 !important; 
      border-radius: 8px !important; 
      margin-bottom: 12px !important; 
      padding: 12px !important; 
      width: 100% !important;
    }
    .scenario-table td { 
      display: block !important; 
      text-align: left !important; 
      padding: 6px 0 !important; 
      border: none !important; 
      position: relative !important;
      width: 100% !important;
    }
    .scenario-table td:before { 
      content: attr(data-label) ": "; 
      font-weight: 600; 
      color: var(--muted); 
      display: inline-block; 
      width: 120px; 
    }
    .scenario-table td:first-child:before { content: "ì£¼ì‹ ìˆ˜ìµë¥ : " !important; }
    .scenario-table td:nth-child(2):before { content: "A(ìê°€): " !important; }
    .scenario-table td:nth-child(3):before { content: "B(ì„¸í›„): " !important; }
    .scenario-table td:nth-child(4):before { content: "ì°¨ì´(Bâˆ’A): " !important; }
    .scenario-table td:nth-child(5):before { content: "ì£¼ì‹ ì„¸ê¸ˆ: " !important; }
    
    /* í°íŠ¸ í¬ê¸° ì¡°ì • */
    .scenario-table { font-size: 13px !important; }
    .scenario-title { font-size: 14px !important; padding: 10px 12px !important; }
    
    /* í…Œì´ë¸” ì»¨í…Œì´ë„ˆ ì˜¤ë²„í”Œë¡œìš° ë°©ì§€ */
    .scenario-group { overflow: hidden !important; }
    .scenario-results { overflow: hidden !important; }
  }
  
  /* JavaScriptë¡œ ê°ì§€ëœ ëª¨ë°”ì¼ í™˜ê²½ìš© ìŠ¤íƒ€ì¼ */
  .mobile-view .scenario-table thead { display: none !important; }
  .mobile-view .scenario-table, 
  .mobile-view .scenario-table tbody, 
  .mobile-view .scenario-table tr { display: block !important; }
  .mobile-view .scenario-table tr { 
    background: #17243a !important; 
    border: 1px solid #314158 !important; 
    border-radius: 8px !important; 
    margin-bottom: 12px !important; 
    padding: 12px !important; 
    width: 100% !important;
  }
  .mobile-view .scenario-table td { 
    display: block !important; 
    text-align: left !important; 
    padding: 6px 0 !important; 
    border: none !important; 
    position: relative !important;
    width: 100% !important;
  }
  .mobile-view .scenario-table td:before { 
    content: attr(data-label) ": "; 
    font-weight: 600; 
    color: var(--muted); 
    display: inline-block; 
    width: 120px; 
  }
  .mobile-view .scenario-table td:first-child:before { content: "ì£¼ì‹ ìˆ˜ìµë¥ : " !important; }
  .mobile-view .scenario-table td:nth-child(2):before { content: "A(ìê°€): " !important; }
  .mobile-view .scenario-table td:nth-child(3):before { content: "B(ì„¸í›„): " !important; }
  .mobile-view .scenario-table td:nth-child(4):before { content: "ì°¨ì´(Bâˆ’A): " !important; }
  .mobile-view .scenario-table td:nth-child(5):before { content: "ì£¼ì‹ ì„¸ê¸ˆ: " !important; }
  
  /* ì¢ì€ í™”ë©´ìš© í…Œì´ë¸” ìŠ¤íƒ€ì¼ - JavaScriptë¡œ ë™ì  ê°ì§€ */
  .narrow-view .scenario-table thead { display: none !important; }
  .narrow-view .scenario-table, 
  .narrow-view .scenario-table tbody, 
  .narrow-view .scenario-table tr { display: block !important; }
  .narrow-view .scenario-table tr { 
    background: #17243a !important; 
    border: 1px solid #314158 !important; 
    border-radius: 8px !important; 
    margin-bottom: 12px !important; 
    padding: 12px !important; 
    width: 100% !important;
  }
  .narrow-view .scenario-table td { 
    display: block !important; 
    text-align: left !important; 
    padding: 6px 0 !important; 
    border: none !important; 
    position: relative !important;
    width: 100% !important;
  }
  .narrow-view .scenario-table td:before { 
    content: attr(data-label) ": "; 
    font-weight: 600; 
    color: var(--muted); 
    display: inline-block; 
    width: 120px; 
  }
  .narrow-view .scenario-table td:first-child:before { content: "ì£¼ì‹ ìˆ˜ìµë¥ : " !important; }
  .narrow-view .scenario-table td:nth-child(2):before { content: "A(ìê°€): " !important; }
  .narrow-view .scenario-table td:nth-child(3):before { content: "B(ì„¸í›„): " !important; }
  .narrow-view .scenario-table td:nth-child(4):before { content: "ì°¨ì´(Bâˆ’A): " !important; }
  .narrow-view .scenario-table td:nth-child(5):before { content: "ì£¼ì‹ ì„¸ê¸ˆ: " !important; }
  .narrow-view .scenario-table { font-size: 13px !important; }
  .narrow-view .scenario-title { font-size: 14px !important; padding: 10px 12px !important; }
  
  /* ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ì „ìš© ìµœì í™” */
  .mobile-device.narrow-view .scenario-table { font-size: 14px !important; }
  .mobile-device.narrow-view .scenario-table td { padding: 8px 0 !important; }
  .mobile-device.narrow-view .scenario-table tr { padding: 14px !important; margin-bottom: 14px !important; }
  .mobile-device.narrow-view .scenario-title { font-size: 15px !important; }
  
  /* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ì „ìš© ìµœì í™” (í„°ì¹˜í•˜ê¸° ì‰½ê²Œ) */
  .touch-device .scenario-table tr { 
    min-height: 44px; /* iOS ê¶Œì¥ í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸° */
    cursor: pointer;
  }
  .touch-device .scenario-table tr:hover {
    background: #1e2a42 !important;
    transform: translateY(-1px);
    transition: all 0.2s ease;
  }
  .touch-device .btn, .touch-device input, .touch-device .collapsible-header {
    min-height: 44px; /* í„°ì¹˜ ì¹œí™”ì  í¬ê¸° */
  }
  
  /* í° ëª¨ë°”ì¼ í™”ë©´ (íƒœë¸”ë¦¿)ì„ ìœ„í•œ ì¡°ì • */
  @media screen and (min-width: 769px) and (max-width: 1024px) {
    .mobile-device .scenario-table { font-size: 15px !important; }
    .mobile-device .scenario-table td { padding: 10px 0 !important; }
  }
  
  @media (max-width: 980px) {
    .grid { grid-template-columns: 1fr; }
    .row { grid-template-columns: 1fr 1fr; }
    .row.triple-input { grid-template-columns: 1fr; grid-template-rows: auto auto auto auto; gap:8px; }
    .row.triple-input > label { grid-column: 1; }
    .row.triple-input > input { grid-column: 1; }
  }
</style>
</head>
<body>
<header>
  <h1>ì„œìš¸ ìê°€(A) vs ì›”ì„¸+íˆ¬ì(B) ì‹œë®¬ë ˆì´í„°</h1>
</header>

<main>
  <section class="card" style="margin-bottom: 20px;">
    <h2>ğŸ“Š í”„ë¡œê·¸ë¨ ì„¤ëª…</h2>
    <div style="line-height: 1.6; color: var(--muted); font-size: 14px;">
      <p><strong style="color: var(--text);">ëª©ì :</strong> ì„œìš¸ ë¶€ë™ì‚° ë§¤ìˆ˜ vs ì›”ì„¸+ì£¼ì‹íˆ¬ì ì „ëµì„ ë¹„êµ ë¶„ì„í•˜ì—¬ ìì‚°ì¶•ì  ê´€ì ì—ì„œ ì–´ëŠ ìª½ì´ ìœ ë¦¬í•œì§€ ì‹œë®¬ë ˆì´ì…˜</p>
      
      <p><strong style="color: var(--text);">í•µì‹¬ ê°€ì •:</strong></p>
      <ul style="margin: 8px 0; padding-left: 20px;">
        <li><strong>Aì „ëµ(ìê°€):</strong> ì•„íŒŒíŠ¸ë¥¼ ëŒ€ì¶œë¡œ ë§¤ìˆ˜í•˜ì—¬ ì„¤ì •í•œ ê¸°ê°„ ë™ì•ˆ ê±°ì£¼í•˜ë©° ì›ë¦¬ê¸ˆ ìƒí™˜</li>
        <li><strong>Bì „ëµ(ì›”ì„¸+íˆ¬ì):</strong> ì „ì„¸ ë˜ëŠ” ì›”ì„¸ë¡œ ê±°ì£¼í•˜ë©°, Aì™€ì˜ ì›” ë¹„ìš© ì°¨ì´ë¶„ì„ í•´ì™¸ì£¼ì‹ì— íˆ¬ì</li>
        <li><strong>ì„¸ê¸ˆ ê³ ë ¤:</strong> ë¶€ë™ì‚° ê´€ë ¨ ì„¸ê¸ˆ(ì·¨ë“ì„¸, ì¬ì‚°ì„¸ ë“±) ë° í•´ì™¸ì£¼ì‹ ê³¼ì„¸ì™€ ì†ìµí†µì‚° í•œë„ ì ìš©</li>
        <li><strong>9ê°€ì§€ ì‹œë‚˜ë¦¬ì˜¤:</strong> ì§‘ê°’ ìƒìŠ¹ë¥ (ë¹„ê´€ì /ì¼ë°˜ì /ë‚™ê´€ì ) Ã— ì£¼ì‹ ìˆ˜ìµë¥ (ë¹„ê´€ì /ì¼ë°˜ì /ë‚™ê´€ì ) ì¡°í•©</li>
        <li><strong>í˜„ì‹¤ì„±:</strong> ì „ì„¸ ê°±ì‹  ì í”„, ëŒ€ì¶œ ì¡°ê±´, ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ë“± ì‹¤ì œ ì‹œì¥ ìš”ì†Œ ë°˜ì˜</li>
        <li><strong>ìœ ì—°ì„±:</strong> ëª¨ë“  ìˆ˜ì¹˜ëŠ” ì•„ë˜ ì…ë ¥ í•„ë“œì—ì„œ ê°œì¸ ìƒí™©ì— ë§ê²Œ ì¡°ì • ê°€ëŠ¥</li>
      </ul>

      <p><strong style="color: var(--text);">ê²°ê³¼ í•´ì„:</strong> B-Aê°€ ì–‘ìˆ˜ë©´ ì›”ì„¸+íˆ¬ìê°€ ìœ ë¦¬, ìŒìˆ˜ë©´ ìê°€ ë§¤ìˆ˜ê°€ ìœ ë¦¬. ê° ì‹œë‚˜ë¦¬ì˜¤ë³„ ë¦¬ìŠ¤í¬ì™€ ìˆ˜ìµì„±ì„ ì¢…í•©ì ìœ¼ë¡œ ê²€í† í•˜ì—¬ ê°œì¸ ìƒí™©ì— ë§ëŠ” ì „ëµ ì„ íƒ ê¶Œì¥</p>
    </div>
  </section>

  <div class="grid">
    <section class="card">
      <h2>ì…ë ¥ íŒŒë¼ë¯¸í„°</h2>
      <fieldset id="inputs">
        <div class="row"><label class="tooltip" data-tooltip="ì•„íŒŒíŠ¸ ë§¤ë§¤ ê°€ê²©ì…ë‹ˆë‹¤. ì˜ˆ: 12ì–µì› â†’ 1200000000 ì…ë ¥">ë§¤ë§¤ê°€ (KRW)</label><input id="price" type="number" value="1200000000"><div class="muted" id="priceDisplay">12ì–µì›</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ëŒ€ì¶œë°›ì„ ë¹„ìœ¨ì…ë‹ˆë‹¤. 80% = 12ì–µ ì§‘ì—ì„œ 9.6ì–µ ëŒ€ì¶œ, 2.4ì–µ ìê¸°ìë³¸. ë†’ì„ìˆ˜ë¡ ë ˆë²„ë¦¬ì§€ íš¨ê³¼â†‘, ê¸ˆë¦¬ë¶€ë‹´â†‘">LTV (ëŒ€ì¶œ ë¹„ìœ¨)</label><input id="ltv" type="number" step="0.01" value="80"><div class="muted" id="ltvDisplay">80%</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ì£¼íƒë‹´ë³´ëŒ€ì¶œ ì—°ì´ììœ¨ì…ë‹ˆë‹¤. ì˜ˆ: 3.95% = ì›”ìƒí™˜ì•¡ ì•½ 500ë§Œì› (12ì–µ, 80% LTV, 30ë…„ ê¸°ì¤€). í˜„ì¬ ì‹œì¤‘ê¸ˆë¦¬ ë°˜ì˜ í•„ìš”">ì£¼ë‹´ëŒ€ ê¸ˆë¦¬ (ì—°)</label><input id="loanRate" type="number" step="0.01" value="3.95"><div id="loanTermLabel" class="muted">ê³ ì • 25ë…„</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ëŒ€ì¶œ ìƒí™˜ ê¸°ê°„ì´ë©´ì„œ ë™ì‹œì— ì‹œë®¬ë ˆì´ì…˜ ê¸°ê°„ì…ë‹ˆë‹¤. 30ë…„ = 360ê°œì›” ìƒí™˜. ì´ ê¸°ê°„ í›„ ì§‘ê°’ê³¼ íˆ¬ì ê²°ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ 20-30ë…„ ì„¤ì •">ê¸°ê°„ (ë…„)</label><input id="years" type="number" value="30"><div class="muted" id="yearsDisplay">30ë…„</div></div>

        <div class="row"><label class="tooltip" data-tooltip="ë§¤ë…„ ë‚©ë¶€í•˜ëŠ” ì¬ì‚°ì„¸ìœ¨ì…ë‹ˆë‹¤. 0.2% = 12ì–µ ì§‘ ê¸°ì¤€ ì—° 240ë§Œì›. ê³µì‹œê°€ê²© ê¸°ì¤€ì´ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë§¤ë§¤ê°€ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ìˆœí™”">ì¬ì‚°ì„¸ìœ¨ (ì—°, ë§¤ë§¤ê°€ ê¸°ì¤€)</label><input id="propTaxRate" type="number" step="0.01" value="0.2"><div class="muted" id="propTaxDisplay">0.2%</div></div>

        <div class="row"><label class="tooltip" data-tooltip="ì „ì„¸ê°€/ë§¤ë§¤ê°€ ë¹„ìœ¨ì…ë‹ˆë‹¤. 60% = 12ì–µ ì§‘ì˜ ì „ì„¸ê°€ 7.2ì–µ. ì„œìš¸ í‰ê·  60-80%. ë‚®ì„ìˆ˜ë¡ ë§¤ìˆ˜ ìœ ë¦¬, ë†’ì„ìˆ˜ë¡ ì „ì„¸ ìœ ë¦¬">ì „ì„¸ê°€ìœ¨</label><input id="jeonseRatio" type="number" step="0.01" value="60"><div class="muted" id="jeonseDisplay">60%</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ì „ì„¸ë³´ì¦ê¸ˆì„ ì›”ì„¸ë¡œ ì „í™˜í•˜ëŠ” ê¸°ì¤€ê¸ˆë¦¬ì…ë‹ˆë‹¤. 5.5% = 7.2ì–µ ì „ì„¸ â†’ ì›”ì„¸ ì•½ 330ë§Œì› + ë³´ì¦ê¸ˆ 1ì–µ. ì€í–‰ ëŒ€ì¶œê¸ˆë¦¬ë³´ë‹¤ ë†’ê²Œ ì±…ì •">ì „ì›”ì„¸ ì „í™˜ìœ¨ (ì—°)</label><input id="convRate" type="number" step="0.01" value="5.5"><div class="muted" id="convRateDisplay">5.5%</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ì›”ì„¸ ê±°ì£¼ ì‹œ ì§€ë¶ˆí•˜ëŠ” ë³´ì¦ê¸ˆì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì „ì„¸ê°€ì˜ 10-20%. 1ì–µ = 7.2ì–µ ì „ì„¸ê°€ì˜ ì•½ 14%ì— í•´ë‹¹">ì›”ì„¸ ë³´ì¦ê¸ˆ</label><input id="deposit" type="number" value="100000000"><div class="muted" id="depositDisplay">1ì–µ</div></div>

        <div class="row"><label class="tooltip" data-tooltip="ì›”ì„¸ ê³„ì•½ ê°±ì‹  ì£¼ê¸°ì…ë‹ˆë‹¤. 24ê°œì›” = 2ë…„ë§ˆë‹¤ ì¬ê³„ì•½. ì¬ê³„ì•½ ì‹œë§ˆë‹¤ ì›”ì„¸ ì¸ìƒ ê°€ëŠ¥. ì§§ì„ìˆ˜ë¡ ì›”ì„¸ ìƒìŠ¹ ì••ë°•â†‘">ì›”ì„¸ ì¬ê³„ì•½ ì£¼ê¸° (ê°œì›”)</label><input id="renewalPeriod" type="number" value="24"><div class="muted" id="renewalPeriodDisplay">24ê°œì›”</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ì¬ê³„ì•½ ì‹œ ì›”ì„¸ ì¸ìƒë¥ ì…ë‹ˆë‹¤. 7% = 330ë§Œì› â†’ 353ë§Œì›. ë¬¼ê°€ìƒìŠ¹ë¥ +Î± ë°˜ì˜. ë†’ì„ìˆ˜ë¡ ì¥ê¸° ì›”ì„¸ ë¶€ë‹´ ì¦ê°€">ì¬ê³„ì•½ ì í”„ìœ¨</label><input id="renewalJump" type="number" step="0.01" value="7"><div class="muted" id="renewalJumpDisplay">+7%</div></div>
        <div class="row"><label class="tooltip" data-tooltip="A(ë§¤ìˆ˜)ì˜ ì›” ë¹„ìš©ì´ B(ì›”ì„¸)ë³´ë‹¤ í´ ë•Œ ì°¨ì•¡ì„ íˆ¬ìí•˜ëŠ” ë¹„ìœ¨ì…ë‹ˆë‹¤. 100% = ì°¨ì•¡ ì „ì•¡ íˆ¬ì. í˜„ì‹¤ì ìœ¼ë¡œëŠ” 80-90% ê¶Œì¥">B ì°¨ì•¡ íˆ¬ììœ¨ (A>Bì¼ ë•Œ)</label><input id="investmentRate" type="number" step="0.01" value="100"><div class="muted" id="investmentRateDisplay">100%</div></div>

        <div class="row"><label class="tooltip" data-tooltip="í•´ì™¸ì£¼ì‹(ETF) ë§¤ë„ ì‹œ ê³¼ì„¸ìœ¨ì…ë‹ˆë‹¤. 22% = 1ì–µ ìˆ˜ìµ ì‹œ 2200ë§Œì› ì„¸ê¸ˆ. êµ­ë‚´ ë°°ë‹¹ì†Œë“ì„¸ìœ¨ê³¼ ë™ì¼. ì—°ë§ ì¼ê´„ ì •ì‚° ê°€ì •">í•´ì™¸ì£¼ì‹ ê³¼ì„¸ (ì—°ë§ ë‹¨ì¼ ì²­ì‚°ì„¸ìœ¨)</label><input id="stockTaxRate" type="number" step="0.01" value="22"><div class="muted" id="stockTaxDisplay">22%</div></div>
        <div class="row"><label class="tooltip" data-tooltip="ì„¸ê¸ˆ ìµœì í™”ë¥¼ ìœ„í•œ ì—°ê°„ ì†ì‹¤ í™•ì • í•œë„ì…ë‹ˆë‹¤. 250ë§Œì› = ì—° 250ë§Œì›ê¹Œì§€ ì†ì‹¤ í™•ì •í•˜ì—¬ ì„¸ê¸ˆ ì ˆì•½. ì‹¤ì œ íˆ¬ìì—ì„œ ì¤‘ìš”í•œ ì ˆì„¸ ì „ëµ">ì—°ë§ í•˜ë² ìŠ¤íŠ¸ ê³µì œ í•œë„</label><input id="harvestDeduction" type="number" value="2500000"><div class="muted" id="harvestDisplay">250ë§Œì›</div></div>

        <div class="collapsible-header" onclick="toggleCollapsible('buyerCosts')">
          <span>ë§¤ìˆ˜ ë¶€ëŒ€ë¹„ìš© (ìƒì„¸ì„¤ì •)</span>
          <span class="chevron" id="buyerCostsChevron">â–¼</span>
        </div>
                <div class="collapsible-content" id="buyerCostsContent">
          <div class="row"><label class="tooltip" data-tooltip="ë¶€ë™ì‚° ì·¨ë“ ì‹œ ë‚©ë¶€í•˜ëŠ” ì„¸ê¸ˆì…ë‹ˆë‹¤. 3% = 12ì–µ Ã— 3% = 3600ë§Œì›. ì‹¤ì œë¡œëŠ” ê³µì‹œê°€ê²© ê¸°ì¤€ì´ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë§¤ë§¤ê°€ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ìˆœí™”">ì·¨ë“ì„¸ìœ¨</label><input id="acqTax" type="number" step="0.01" value="3"><div class="muted" id="acqTaxDisplay">3%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ì†Œìœ ê¶Œ ë“±ê¸° ì‹œ ë‚©ë¶€í•˜ëŠ” ì„¸ê¸ˆì…ë‹ˆë‹¤. 2% = 12ì–µ Ã— 2% = 2400ë§Œì›. ë“±ê¸°ì†Œì—ì„œ ì†Œìœ ê¶Œ ì´ì „ ë“±ê¸° ì‹œ ë‚©ë¶€">ë“±ë¡ë©´í—ˆì„¸ìœ¨</label><input id="regTax" type="number" step="0.01" value="2"><div class="muted" id="regTaxDisplay">2%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ì·¨ë“ì„¸ì— ì¶”ê°€ ë¶€ê³¼ë˜ëŠ” ì§€ë°©êµìœ¡ì„¸ì…ë‹ˆë‹¤. 0.3% = 12ì–µ Ã— 0.3% = 360ë§Œì›. ì·¨ë“ì„¸ì˜ 10% ìˆ˜ì¤€ìœ¼ë¡œ ìë™ ë¶€ê³¼">ì§€ë°©êµìœ¡ì„¸(ì·¨ë“)ìœ¨</label><input id="localEduAcq" type="number" step="0.01" value="0.3"><div class="muted" id="localEduAcqDisplay">0.3%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ì¤‘ê°œë³´ìˆ˜ì— ë¶€ê³¼ë˜ëŠ” ë†ì–´ì´ŒíŠ¹ë³„ì„¸ì…ë‹ˆë‹¤. 0.2% = ì¤‘ê°œë³´ìˆ˜ 720ë§Œì› Ã— 0.2% = 1.4ë§Œì›. ì¤‘ê°œë³´ìˆ˜ì˜ 20% ìˆ˜ì¤€">ë†íŠ¹ì„¸ìœ¨(ë³´ìˆ˜ ê°€ì •)</label><input id="rural" type="number" step="0.01" value="0.2"><div class="muted" id="ruralDisplay">0.2%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ë“±ë¡ë©´í—ˆì„¸ì— ì¶”ê°€ ë¶€ê³¼ë˜ëŠ” ì§€ë°©êµìœ¡ì„¸ ë¹„ìœ¨ì…ë‹ˆë‹¤. 20% = ë“±ë¡ë©´í—ˆì„¸ 2400ë§Œì› Ã— 20% = 480ë§Œì›">ì§€ë°©êµìœ¡ì„¸(ë“±ë¡) ë¹„ìœ¨(ë“±ë¡ë©´í—ˆì„¸ì˜)</label><input id="localEduRegRatio" type="number" step="0.01" value="20"><div class="muted" id="localEduRegDisplay">20%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ë¶€ë™ì‚° ì¤‘ê°œì—…ì²´ ìˆ˜ìˆ˜ë£Œì…ë‹ˆë‹¤. 0.6% = 12ì–µ Ã— 0.6% = 720ë§Œì›. ë²•ì • ìƒí•œì„  ê¸°ì¤€. ì‹¤ì œë¡œëŠ” í˜‘ìƒ ê°€ëŠ¥">ì¤‘ê°œë³´ìˆ˜ìœ¨(ìƒí•œ ê°€ì •)</label><input id="brokerage" type="number" step="0.01" value="0.6"><div class="muted" id="brokerageDisplay">0.6%</div></div>
          <div class="row"><label class="tooltip" data-tooltip="ê¸°íƒ€ ë¶€ëŒ€ë¹„ìš©ì…ë‹ˆë‹¤. 20ë§Œì› = ê°ì •í‰ê°€ë¹„, ë²•ë¬´ì‚¬ë¹„, ì¸ì§€ì„¸ ë“±. ì‹¤ì œë¡œëŠ” 100-300ë§Œì› ìˆ˜ì¤€ì´ì§€ë§Œ ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”">ê¸°íƒ€ ìˆ˜ìˆ˜ë£Œ(ì •ì•¡)</label><input id="minorFees" type="number" value="200000"><div class="muted" id="minorFeesDisplay">20ë§Œì›</div></div>
        </div>

        <div class="row triple-input"><label class="tooltip" data-tooltip="ì§‘ê°’ ì—°í‰ê·  ì„±ì¥ë¥  ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤. ë¹„ê´€ì  2% = 30ë…„ í›„ 1.8ë°°, ì¼ë°˜ì  3.5% = 2.8ë°°, ë‚™ê´€ì  5% = 4.3ë°°. ê³¼ê±° ì„œìš¸ ë°ì´í„° ê¸°ë°˜ ì„¤ì •">ì§‘ê°’ ì—°í‰ê·  ì„±ì¥ë¥  (ë¹„ê´€ì /ì¼ë°˜ì /ë‚™ê´€ì ) (%)</label>
          <input id="homeBear" type="number" step="0.01" value="2">
          <input id="homeBase" type="number" step="0.01" value="3.5">
          <input id="homeBull" type="number" step="0.01" value="5">
        </div>
        <div class="row triple-input"><label class="tooltip" data-tooltip="ì£¼ì‹ ì—°í‰ê·  ìˆ˜ìµë¥  ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤. ë¹„ê´€ì  8% = 30ë…„ í›„ 10ë°°, ì¼ë°˜ì  12% = 30ë°°, ë‚™ê´€ì  15% = 66ë°°. ê¸€ë¡œë²Œ ì£¼ì‹ ETF ê¸°ì¤€ ì„¤ì •">ì£¼ì‹ ì—°í‰ê·  ì„±ì¥ë¥  (ë¹„ê´€ì /ì¼ë°˜ì /ë‚™ê´€ì ) (%)</label>
          <input id="qqqBear" type="number" step="0.01" value="8">
          <input id="qqqBase" type="number" step="0.01" value="12">
          <input id="qqqBull" type="number" step="0.01" value="15">
        </div>

        <div class="row-checkbox">
          <input id="includeBuyerCosts" type="checkbox" checked>
          <label for="includeBuyerCosts">Aì— ë§¤ìˆ˜ ë¶€ëŒ€ë¹„ìš© í¬í•¨</label>
        </div>
        <div class="row-checkbox">
          <input id="includeRenewalJumps" type="checkbox" checked>
          <label for="includeRenewalJumps">Bì— ì¬ê³„ì•½ ì í”„(ì£¼ê¸°/ìœ¨) ì ìš©</label>
        </div>
        <div class="row-checkbox">
          <input id="useHarvest" type="checkbox" checked>
          <label for="useHarvest">ì—°ë§ 250ë§Œ ì› í•˜ë² ìŠ¤íŠ¸ ì ìš©</label>
        </div>
        <button id="resetBtn" class="btn" type="button">ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹</button>
      </fieldset>
      <div class="footer-note">ì°¸ê³ : ê¸°ë³¸ê°’ì€ ì§ì „ ê³„ì‚°ì—ì„œ ì‚¬ìš©í•œ ê°’ë“¤ì…ë‹ˆë‹¤. ëª¨ë“  í•„ë“œëŠ” ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
    </section>

    <section class="card">
      <h2>ìš”ì•½</h2>
      <div id="summary" class="mono" style="line-height:1.6"></div>
      <div class="grid-2" style="margin-top:12px">
        <div>
          <div class="muted">ë§¤ìˆ˜ ë¶€ëŒ€ë¹„ìš©</div>
          <div id="buyerCostsDisplay" class="mono"></div>
          <div class="muted" style="margin-top:6px">A ì›” ìƒí™˜(ì›ë¦¬ê¸ˆ)</div>
          <div id="mortgagePmt" class="mono"></div>
          <div class="muted" style="margin-top:6px">1ê°œì›”ì°¨ A ì´ì§€ì¶œ</div>
          <div id="month1A" class="mono"></div>
        </div>
        <div>
          <div class="muted">B ì´ˆê¸° íˆ¬ìê¸ˆì•¡</div>
          <div id="initInvestB" class="mono"></div>
          <div class="muted" style="margin-top:6px">ì‹œì‘ ì›”ì„¸</div>
          <div id="startRent" class="mono"></div>
          <div class="muted" style="margin-top:6px">ë§ˆì§€ë§‰ ì›”ì„¸ (360ê°œì›”ì°¨)</div>
          <div id="endRent" class="mono"></div>
          <div class="muted" style="margin-top:6px">1ê°œì›”ì°¨ B ì´ì§€ì¶œ</div>
          <div id="month1B" class="mono"></div>
        </div>
      </div>
    </section>
  </div>

  <section class="card" style="margin-top:16px">
    <h2 id="resultsTitle">ê²°ê³¼ (30ë…„ ë§ ì„¸í›„ ìˆœìì‚°, ë‹¨ìœ„ KRW)</h2>
    <div id="results"></div>
  </section>

  <section class="card" style="margin-top:16px">
    <h2>A ì´ˆê¸° í˜„ê¸ˆ ë° ë¶€ëŒ€ë¹„ìš© ë‚´ì—­</h2>
    <div id="costBreak" class="mono"></div>
  </section>
</main>

<script>
function fmtKRW(v){
  // NaNì´ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ ê°’ ì²˜ë¦¬
  if (isNaN(v) || v === null || v === undefined) return '0';
  
  try{
    return new Intl.NumberFormat('ko-KR', {maximumFractionDigits:0}).format(Math.round(v));
  }catch(e){
    return String(Math.round(v || 0));
  }
}
function pct(v){ return (v*100).toFixed(2)+'%'; }

function formatPrice(value) {
  const val = Number(value);
  if (val >= 100000000) {
    const eok = val / 100000000;
    if (eok % 1 === 0) {
      return eok + 'ì–µì›';
    } else {
      return parseFloat(eok.toFixed(1)) + 'ì–µì›';
    }
  } else if (val >= 10000) {
    return (val / 10000).toFixed(0) + 'ë§Œì›';
  } else {
    return val.toLocaleString() + 'ì›';
  }
}

// ë¶ˆí•„ìš”í•œ ì†Œìˆ«ì  ì œê±° í•¨ìˆ˜
function formatNumber(num, maxDecimals = 2) {
  if (num % 1 === 0) {
    return num.toString();
  }
  return parseFloat(num.toFixed(maxDecimals)).toString();
}

function updateDynamicTexts() {
  const get = id => document.getElementById(id);
  
  // ë§¤ë§¤ê°€ í‘œì‹œ
  const price = Number(get('price').value);
  get('priceDisplay').textContent = formatPrice(price);
  
  // LTV í‘œì‹œ
  const ltv = Number(get('ltv').value);
  get('ltvDisplay').textContent = formatNumber(ltv, 1) + '%';
  
  // ëŒ€ì¶œê¸ˆë¦¬ í‘œì‹œ (render í•¨ìˆ˜ì—ì„œ ë…„ìˆ˜ ì—…ë°ì´íŠ¸)
  const loanRate = Number(get('loanRate').value);
  const years = Number(get('years').value);
  get('loanTermLabel').textContent = `${formatNumber(loanRate, 2)}%, ê³ ì • ${years}ë…„`;
  
  // ê¸°ê°„ í‘œì‹œ
  get('yearsDisplay').textContent = years + 'ë…„';
  
  // ì¬ì‚°ì„¸ìœ¨ í‘œì‹œ
  const propTaxRate = Number(get('propTaxRate').value);
  get('propTaxDisplay').textContent = formatNumber(propTaxRate, 2) + '%';
  
  // ì „ì„¸ê°€ìœ¨ í‘œì‹œ
  const jeonseRatio = Number(get('jeonseRatio').value);
  get('jeonseDisplay').textContent = formatNumber(jeonseRatio, 1) + '%';
  
  // ì „ì›”ì„¸ ì „í™˜ìœ¨ í‘œì‹œ
  const convRate = Number(get('convRate').value);
  get('convRateDisplay').textContent = formatNumber(convRate, 2) + '%';
  
  // ì›”ì„¸ ë³´ì¦ê¸ˆ í‘œì‹œ
  const deposit = Number(get('deposit').value);
  get('depositDisplay').textContent = formatPrice(deposit);
  
  // ì¬ê³„ì•½ ì£¼ê¸° í‘œì‹œ
  const renewalPeriod = Number(get('renewalPeriod').value);
  get('renewalPeriodDisplay').textContent = renewalPeriod + 'ê°œì›”';
  
  // ì¬ê³„ì•½ ì í”„ìœ¨ í‘œì‹œ
  const renewalJump = Number(get('renewalJump').value);
  get('renewalJumpDisplay').textContent = '+' + formatNumber(renewalJump, 1) + '%';
  
  // ì°¨ì•¡ íˆ¬ììœ¨ í‘œì‹œ
  const investmentRate = Number(get('investmentRate').value);
  get('investmentRateDisplay').textContent = formatNumber(investmentRate, 0) + '%';
  
  // í•´ì™¸ì£¼ì‹ ê³¼ì„¸ í‘œì‹œ
  const stockTaxRate = Number(get('stockTaxRate').value);
  get('stockTaxDisplay').textContent = formatNumber(stockTaxRate, 1) + '%';
  
  // í•˜ë² ìŠ¤íŠ¸ ê³µì œ í•œë„ í‘œì‹œ
  const harvestDeduction = Number(get('harvestDeduction').value);
  get('harvestDisplay').textContent = formatPrice(harvestDeduction);
  
  // ì·¨ë“ì„¸ìœ¨ í‘œì‹œ
  const acqTax = Number(get('acqTax').value);
  get('acqTaxDisplay').textContent = formatNumber(acqTax, 2) + '%';
  
  // ë“±ë¡ë©´í—ˆì„¸ìœ¨ í‘œì‹œ
  const regTax = Number(get('regTax').value);
  get('regTaxDisplay').textContent = formatNumber(regTax, 2) + '%';
  
  // ì§€ë°©êµìœ¡ì„¸(ì·¨ë“) í‘œì‹œ
  const localEduAcq = Number(get('localEduAcq').value);
  get('localEduAcqDisplay').textContent = formatNumber(localEduAcq, 2) + '%';
  
  // ë†íŠ¹ì„¸ í‘œì‹œ
  const rural = Number(get('rural').value);
  get('ruralDisplay').textContent = formatNumber(rural, 2) + '%';
  
  // ì§€ë°©êµìœ¡ì„¸(ë“±ë¡) í‘œì‹œ
  const localEduRegRatio = Number(get('localEduRegRatio').value);
  get('localEduRegDisplay').textContent = formatNumber(localEduRegRatio, 1) + '%';
  
  // ì¤‘ê°œë³´ìˆ˜ìœ¨ í‘œì‹œ
  const brokerage = Number(get('brokerage').value);
  get('brokerageDisplay').textContent = formatNumber(brokerage, 2) + '%';
  
  // ê¸°íƒ€ ìˆ˜ìˆ˜ë£Œ í‘œì‹œ
  const minorFees = Number(get('minorFees').value);
  get('minorFeesDisplay').textContent = formatPrice(minorFees);
}

function computeMortgagePmt(P, rAnnual, nMonths){
  // ëŒ€ì¶œ ì›ê¸ˆì´ 0ì´ë©´ ì›” ìƒí™˜ì•¡ë„ 0
  if (P <= 0) return 0;
  
  // ê¸ˆë¦¬ê°€ 0ì´ë©´ ì›ê¸ˆì„ ê°œì›” ìˆ˜ë¡œ ë‚˜ëˆˆ ê°’ (ë¬´ì´ì í• ë¶€)
  if (rAnnual <= 0) return P / nMonths;
  
  // ì¼ë°˜ì ì¸ ë³µë¦¬ ê³„ì‚°
  const r = rAnnual/12; 
  return r*P / (1 - Math.pow(1+r, -nMonths));
}

function simulate(params){
  const {
    price, ltv: ltvPercent, loanRate: loanRatePercent, years,
    propTaxRate: propTaxRatePercent,
    jeonseRatio: jeonseRatioPercent, convRate: convRatePercent, deposit,
    renewalPeriod, renewalJump: renewalJumpPercent, investmentRate: investmentRatePercent,
    stockTaxRate: stockTaxRatePercent, harvestDeduction,
    acqTax: acqTaxPercent, regTax: regTaxPercent, localEduAcq: localEduAcqPercent, 
    rural: ruralPercent, localEduRegRatio: localEduRegRatioPercent, 
    brokerage: brokeragePercent, minorFees,
    homeCases, qqqCases,
    includeBuyerCosts, includeRenewalJumps, useHarvest
  } = params;

  // ë°±ë¶„ìœ¨ì„ ì†Œìˆ˜ë¡œ ë³€í™˜
  const ltv = ltvPercent / 100;
  const loanRate = loanRatePercent / 100;
  const propTaxRate = propTaxRatePercent / 100;
  const jeonseRatio = jeonseRatioPercent / 100;
  const convRate = convRatePercent / 100;
  const renewalJump = renewalJumpPercent / 100;
  const investmentRate = investmentRatePercent / 100;
  const stockTaxRate = stockTaxRatePercent / 100;
  const acqTax = acqTaxPercent / 100;
  const regTax = regTaxPercent / 100;
  const localEduAcq = localEduAcqPercent / 100;
  const rural = ruralPercent / 100;
  const localEduRegRatio = localEduRegRatioPercent / 100;
  const brokerage = brokeragePercent / 100;

  const months = years*12;
  const loanPrincipal = price * ltv;
  const pmt = computeMortgagePmt(loanPrincipal, loanRate, months);
  const propTaxMonthly = price * propTaxRate / 12;

  // Buyer closing costs
  const acq = acqTax * price;
  const reg = regTax * price;
  const localEduAcqAmt = localEduAcq * price;
  const ruralAmt = rural * price;
  const localEduRegAmt = localEduRegRatio * reg;
  const brokerageAmt = brokerage * price;
  const buyerCosts = includeBuyerCosts ? (acq + reg + localEduAcqAmt + ruralAmt + localEduRegAmt + brokerageAmt + minorFees) : 0;

  const initialCashA = (price * (1 - ltv)) + buyerCosts; // Aì˜ ì´ˆê¸° í˜„ê¸ˆ í•„ìš”ì•¡

  // Rent via Jeonse->Wolse
  const jeonsePrice = price * jeonseRatio;
  const startRent = (jeonsePrice - deposit) * (convRate/12);

  // B ì´ˆê¸° ì¼ì‹œíˆ¬ì = Aì´ˆê¸°í˜„ê¸ˆ - ë³´ì¦ê¸ˆ(ë¬¶ì„)
  const initInvestB = initialCashA - deposit;

  function runCase(homeCAGR, qqqCAGR){
    const gQ = Math.pow(1+qqqCAGR, 1/12) - 1;
    const gH = Math.pow(1+homeCAGR, 1/12) - 1; // ì›”ë³„ ì§‘ê°’ ì„±ì¥ë¥ 
    let currentHousePrice = price; // í˜„ì¬ ì§‘ê°’ ì¶”ì 
    let rent = startRent*1.0;
    let investBal = initInvestB*1.0;
    let basis = initInvestB*1.0; // ì„¸ë¬´ìƒ ì›ê°€
    let remaining = loanPrincipal*1.0;

    let m1A=0, m1B=0;

    for(let m=1;m<=months;m++){
      // ì§‘ê°’ ìƒìŠ¹ ë°˜ì˜
      currentHousePrice *= (1 + gH);
      
      // ì¬ê³„ì•½ ì‹œ ì§‘ê°’ ìƒìŠ¹ì„ ë°˜ì˜í•œ ì›”ì„¸ ì¬ê³„ì‚°
      if(includeRenewalJumps && m>1 && (m-1)%renewalPeriod===0){ 
        // í˜„ì¬ ì§‘ê°’ ê¸°ì¤€ìœ¼ë¡œ ì „ì„¸ê°€ ì¬ê³„ì‚°
        const currentJeonsePrice = currentHousePrice * jeonseRatio;
        const marketRent = (currentJeonsePrice - deposit) * (convRate/12);
        // ì‹œì¥ ì›”ì„¸ì— ì¬ê³„ì•½ ì í”„ ì¶”ê°€ ì ìš©
        rent = marketRent * (1 + renewalJump);
      }

      // ëŒ€ì¶œ ê´€ë ¨ ê³„ì‚° (ëŒ€ì¶œì´ ìˆëŠ” ê²½ìš°ì—ë§Œ)
      let interest = 0;
      let principal = 0;
      
      if (remaining > 0 && pmt > 0) {
        interest = remaining * (loanRate/12);
        principal = pmt - interest;
        remaining = Math.max(0, remaining - principal);
      }

      // í˜„ì¬ ì§‘ê°’ ê¸°ì¤€ ì¬ì‚°ì„¸ (ë§¤ë…„ ì¬í‰ê°€ ê°€ì •)
      const currentPropTaxMonthly = currentHousePrice * propTaxRate / 12;
      const A_cost = pmt + currentPropTaxMonthly;
      const B_cost = rent;
      if(m===1){ m1A=Math.round(A_cost); m1B=Math.round(B_cost); }

      // ì„±ì¥ â†’ ì ë¦½ (A < Bì¸ ê²½ìš° ê¸°ì¡´ íˆ¬ìì—ì„œ ì¸ì¶œ)
      investBal *= (1+gQ);
      const investThisMonth = A_cost - B_cost; // ì–‘ìˆ˜ë©´ íˆ¬ì, ìŒìˆ˜ë©´ ì¸ì¶œ
      
      if(investThisMonth > 0){
        // Aê°€ ë” ë¹„ì‹¸ë©´: ì°¨ì•¡ì˜ investmentRate%ë§Œ íˆ¬ì, ë‚˜ë¨¸ì§€ëŠ” ì†Œë¹„
        const actualInvestment = investThisMonth * investmentRate;
        investBal += actualInvestment; 
        basis += actualInvestment;
      } else if(investThisMonth < 0){
        // Bê°€ ë” ë¹„ì‹¸ë©´: ê¸°ì¡´ íˆ¬ìì—ì„œ ì¸ì¶œ
        const withdrawAmount = Math.abs(investThisMonth);
        if(investBal >= withdrawAmount){
          // íˆ¬ì ì”ê³ ì—ì„œ ì¸ì¶œ ê°€ëŠ¥
          investBal -= withdrawAmount;
          // ì›ê°€ë„ ë¹„ë¡€ì ìœ¼ë¡œ ê°ì†Œ (FIFO ê°€ì •)
          const withdrawRatio = withdrawAmount / (investBal + withdrawAmount);
          basis = basis * (1 - withdrawRatio);
        } else {
          // íˆ¬ì ì”ê³  ë¶€ì¡± ì‹œ ì „ì•¡ ì¸ì¶œ (íŒŒì‚° ì‹œë‚˜ë¦¬ì˜¤)
          basis = 0;
          investBal = 0;
        }
      }
      // investThisMonth == 0ì´ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ

      // ì—°ë§ í•˜ë² ìŠ¤íŠ¸
      if(useHarvest && m%12===0){
        const unr = Math.max(0, investBal - basis);
        const harvest = Math.min(unr, harvestDeduction);
        if(harvest>0){ basis += harvest; } // ì¦‰ì‹œ ì¬ë§¤ìˆ˜, ì”ê³  ë¶ˆë³€
      }
    }

    // ìµœì¢… ê³¼ì„¸(ì”ì—¬ ë¯¸ì‹¤í˜„ ì´ìµ)
    const finalUnreal = Math.max(0, investBal - basis);
    const finalTax = finalUnreal * stockTaxRate;
    const B_afterTax = investBal + deposit - finalTax;

    // A ìµœì¢… (ìê°€) â€” ëŒ€ì¶œ ì „ì•¡ ìƒí™˜ ê°€ì •, 1ì£¼íƒ ë¹„ê³¼ì„¸
    const A_house = currentHousePrice; // ì´ë¯¸ ë§¤ì›” ì„±ì¥ì´ ëˆ„ì ëœ ê°’

    return { A_house, B_afterTax, diff: B_afterTax - A_house, m1A, m1B, pmt, startRent, endRent: rent, buyerCosts, initialCashA, initInvestB,
             breakdown: {acq, reg, localEduAcqAmt, ruralAmt, localEduRegAmt, brokerageAmt, minorFees}, finalTax };
  }

  const rows=[];
  const casesOut = {};
  const homeScenarioMap = ['pess', 'base', 'opt']; // ë¹„ê´€ì , ì¼ë°˜ì , ë‚™ê´€ì 

  for(let i = 0; i < homeCases.length; i++){
    const [labelH, h] = homeCases[i];
    const homeScenario = homeScenarioMap[i];
    
    for(const [labelQ, q] of qqqCases){
      const r = runCase(h, q);
      rows.push({ 
        home: labelH, 
        qqq: labelQ, 
        A: r.A_house, 
        B: r.B_afterTax, 
        diff: r.diff, 
        tax: r.finalTax,
        homeScenario: homeScenario
      });
      casesOut[labelH+"|"+labelQ]=r;
    }
  }

  // Find Base case key dynamically (middle case)
  const baseHomeCase = homeCases[1]; // Base is always the middle case
  const baseStockCase = qqqCases[1]; // Base is always the middle case
  const baseKey = `${baseHomeCase[0]}|${baseStockCase[0]}`;

  return { rows, casesOut, pmt, startRent, endRent: casesOut[baseKey]?.endRent || 0, buyerCosts, initialCashA, initInvestB };
}

function render(){
  const get = id => document.getElementById(id);
  
  // Update results title dynamically
  const yearsValue = +get('years').value;
  document.getElementById('resultsTitle').textContent = `ê²°ê³¼ (${yearsValue}ë…„ ë§ ì„¸í›„ ìˆœìì‚°, ë‹¨ìœ„ KRW)`;
  
  const p = {
    price: +get('price').value,
    ltv: +get('ltv').value,
    loanRate: +get('loanRate').value,
    years: yearsValue,
    propTaxRate: +get('propTaxRate').value,
    jeonseRatio: +get('jeonseRatio').value,
    convRate: +get('convRate').value,
    deposit: +get('deposit').value,
    renewalPeriod: +get('renewalPeriod').value,
    renewalJump: +get('renewalJump').value,
    investmentRate: +get('investmentRate').value,
    stockTaxRate: +get('stockTaxRate').value,
    harvestDeduction: +get('harvestDeduction').value,
    acqTax: +get('acqTax').value,
    regTax: +get('regTax').value,
    localEduAcq: +get('localEduAcq').value,
    rural: +get('rural').value,
    localEduRegRatio: +get('localEduRegRatio').value,
    brokerage: +get('brokerage').value,
    minorFees: +get('minorFees').value,
    homeCases: [
      [`ë¹„ê´€ì  ${(+get('homeBear').value).toFixed(1)}%`, +get('homeBear').value / 100],
      [`ì¼ë°˜ì  ${(+get('homeBase').value).toFixed(1)}%`, +get('homeBase').value / 100],
      [`ë‚™ê´€ì  ${(+get('homeBull').value).toFixed(1)}%`, +get('homeBull').value / 100]
    ],
    qqqCases: [
      [`ì£¼ì‹ ë¹„ê´€ì  ${(+get('qqqBear').value).toFixed(0)}%`, +get('qqqBear').value / 100],
      [`ì£¼ì‹ ì¼ë°˜ì  ${(+get('qqqBase').value).toFixed(0)}%`, +get('qqqBase').value / 100],
      [`ì£¼ì‹ ë‚™ê´€ì  ${(+get('qqqBull').value).toFixed(0)}%`, +get('qqqBull').value / 100]
    ],
    includeBuyerCosts: get('includeBuyerCosts').checked,
    includeRenewalJumps: get('includeRenewalJumps').checked,
    useHarvest: get('useHarvest').checked,
  };

  const { rows, casesOut, pmt, startRent, endRent, buyerCosts, initialCashA, initInvestB } = simulate(p);

  // Update dynamic texts
  updateDynamicTexts();

  // Build results table grouped by housing scenarios
  let tableHtml = '<div class="scenario-results">';
  
  // Group results by housing scenario
  const scenarioLabels = {
    'pess': 'ë¹„ê´€ì  ì§‘ê°’ ì‹œë‚˜ë¦¬ì˜¤',
    'base': 'ì¼ë°˜ì  ì§‘ê°’ ì‹œë‚˜ë¦¬ì˜¤', 
    'opt': 'ë‚™ê´€ì  ì§‘ê°’ ì‹œë‚˜ë¦¬ì˜¤'
  };
  
  const homeScenarios = ['pess', 'base', 'opt'];
  
  homeScenarios.forEach(homeScenario => {
    const scenarioRows = rows.filter(r => r.homeScenario === homeScenario);
    if (scenarioRows.length === 0) return;
    
    const scenarioTitle = scenarioLabels[homeScenario];
    const homeRate = scenarioRows[0].home; // All rows in this scenario have same home rate
    const yearsValue = +get('years').value;
    
    tableHtml += `<div class="scenario-group">`;
    tableHtml += `<h3 class="scenario-title">${scenarioTitle} (${homeRate})</h3>`;
    tableHtml += `<table class="scenario-table">`;
    tableHtml += `<thead><tr><th>ì£¼ì‹ ì—°í‰ê·  ì„±ì¥ë¥ </th><th>A(ìê°€) @${yearsValue}y</th><th>B(ì„¸í›„) @${yearsValue}y</th><th>ì°¨ì´(Bâˆ’A)</th><th>B ì£¼ì‹ ìµœì¢… ê³¼ì„¸</th></tr></thead>`;
    tableHtml += `<tbody>`;
    
    scenarioRows.forEach(r => {
      const cls = r.diff >= 0 ? 'good' : 'bad';
      tableHtml += `<tr><td>${r.qqq}</td><td class="mono">${fmtKRW(r.A)}</td><td class="mono">${fmtKRW(r.B)}</td><td class="mono ${cls}">${fmtKRW(r.diff)}</td><td class="mono">${fmtKRW(r.tax)}</td></tr>`;
    });
    
    tableHtml += `</tbody></table></div>`;
  });
  
  tableHtml += '</div>';
  document.getElementById('results').innerHTML = tableHtml;

  // Summary (take Base case as spotlight if exists)
  const baseHomeLabel = `ì¼ë°˜ì  ${(+get('homeBase').value).toFixed(1)}%`;
  const baseStockLabel = `ì£¼ì‹ ì¼ë°˜ì  ${(+get('qqqBase').value).toFixed(0)}%`;
  const key = `${baseHomeLabel}|${baseStockLabel}`;
  const k = casesOut[key];
  const s = [];
  
  // ì œëª©
  s.push(`<div class="summary-title">ì¼ë°˜ì  ì‹œë‚˜ë¦¬ì˜¤ ê²°ê³¼</div>`);
  s.push(`<div class="summary-subtitle">ì§‘ê°’ ${(+get('homeBase').value).toFixed(1)}% Â· ì£¼ì‹ ${(+get('qqqBase').value).toFixed(0)}% (${+get('years').value}ë…„ í›„)</div>`);
  
  if(k){
    // ìµœì¢… ìì‚° ë¹„êµ
    const diffColor = k.diff >= 0 ? '#2ecc71' : '#ff6b6b';
    const diffSymbol = k.diff >= 0 ? '+' : '';
    const winner = k.diff >= 0 ? 'ì›”ì„¸+íˆ¬ì ìŠ¹ë¦¬' : 'ìê°€ êµ¬ë§¤ ìŠ¹ë¦¬';
    const winnerClass = k.diff >= 0 ? 'winner-invest' : 'winner-buy';
    
    s.push(`<div class="summary-comparison">`);
    s.push(`  <div class="summary-row">`);
    s.push(`    <span class="label">ğŸ  A(ìê°€êµ¬ë§¤)</span>`);
    s.push(`    <span class="value">${fmtKRW(k.A_house)}</span>`);
    s.push(`  </div>`);
    s.push(`  <div class="summary-row">`);
    s.push(`    <span class="label">ğŸ“ˆ B(ì›”ì„¸+íˆ¬ì)</span>`);
    s.push(`    <span class="value">${fmtKRW(k.B_afterTax)}</span>`);
    s.push(`  </div>`);
    s.push(`  <div class="summary-row result-row">`);
    s.push(`    <span class="label">ğŸ’° ì°¨ì´ (Bâˆ’A)</span>`);
    s.push(`    <span class="value difference" style="color:${diffColor}">${diffSymbol}${fmtKRW(Math.abs(k.diff))}</span>`);
    s.push(`  </div>`);
    s.push(`  <div class="summary-conclusion ${winnerClass}">${winner}</div>`);
    s.push(`</div>`);
    
    // ì„¸ë¶€ ì •ë³´
    s.push(`<div class="summary-details">`);
    s.push(`  <div class="detail-item">ğŸ’¸ ì£¼ì‹ íˆ¬ì ì„¸ê¸ˆ: ${fmtKRW(k.finalTax)}</div>`);
    s.push(`  <div class="detail-item">ğŸ“… ì²« ë‹¬ ë¹„ìš© ì°¨ì´: ${fmtKRW(Math.abs(k.m1A-k.m1B))} ${k.m1A > k.m1B ? '(Aê°€ ë” ë¹„ìŒˆ â†’ íˆ¬ì ê°€ëŠ¥)' : '(Bê°€ ë” ë¹„ìŒˆ â†’ íˆ¬ì ë¶ˆê°€)'}</div>`);
    s.push(`</div>`);
  }
  document.getElementById('summary').innerHTML = s.join('');

  document.getElementById('mortgagePmt').textContent = fmtKRW(pmt);
  document.getElementById('initInvestB').textContent = fmtKRW(initInvestB);
  document.getElementById('startRent').textContent = fmtKRW(startRent);
  document.getElementById('endRent').textContent = fmtKRW(endRent);
  document.getElementById('buyerCostsDisplay').textContent = fmtKRW(buyerCosts);
  if(k){
    document.getElementById('month1A').textContent = fmtKRW(k.m1A);
    document.getElementById('month1B').textContent = fmtKRW(k.m1B);
  }

  // Buyer cost breakdown
  if(k){
    const b = k.breakdown;
    const lines = [
      `ë§¤ìˆ˜ ë¶€ëŒ€ë¹„ìš© í•©ê³„: <b>${fmtKRW(buyerCosts)}</b> | A ì´ˆê¸° í˜„ê¸ˆ(ìê¸°ìë³¸+ë¶€ëŒ€ë¹„ìš©): <b>${fmtKRW(initialCashA)}</b> | B ì´ˆê¸° ì¼ì‹œíˆ¬ì(=Aí˜„ê¸ˆâˆ’ë³´ì¦ê¸ˆ): <b>${fmtKRW(initInvestB)}</b>`,
      `Â· ì·¨ë“ì„¸: ${fmtKRW(b.acq)} | ë“±ë¡ë©´í—ˆì„¸: ${fmtKRW(b.reg)} | ì§€ë°©êµìœ¡ì„¸(ì·¨ë“): ${fmtKRW(b.localEduAcqAmt)}`,
      `Â· ë†íŠ¹ì„¸(ê°€ì •): ${fmtKRW(b.ruralAmt)} | ì§€ë°©êµìœ¡ì„¸(ë“±ë¡): ${fmtKRW(b.localEduRegAmt)} | ì¤‘ê°œë³´ìˆ˜: ${fmtKRW(b.brokerageAmt)} | ê¸°íƒ€: ${fmtKRW(b.minorFees)}`
    ];
    document.getElementById('costBreak').innerHTML = lines.join('<br/>');
  }
}

function bind(){
  const inputs = document.querySelectorAll('#inputs input, #inputs select');
  inputs.forEach(el=> el.addEventListener('input', render));
  document.getElementById('resetBtn').addEventListener('click', ()=>{
    document.getElementById('price').value = 1200000000;
    document.getElementById('ltv').value = 80.00;
    document.getElementById('loanRate').value = 3.95;
    document.getElementById('years').value = 30;
    document.getElementById('propTaxRate').value = 0.20;
    document.getElementById('jeonseRatio').value = 60.00;
    document.getElementById('convRate').value = 5.50;
    document.getElementById('deposit').value = 100000000;
    document.getElementById('renewalPeriod').value = 24;
    document.getElementById('renewalJump').value = 7.00;
    document.getElementById('investmentRate').value = 100.0;
    document.getElementById('stockTaxRate').value = 22.0;
    document.getElementById('harvestDeduction').value = 2500000;
    document.getElementById('acqTax').value = 3.00;
    document.getElementById('regTax').value = 2.00;
    document.getElementById('localEduAcq').value = 0.30;
    document.getElementById('rural').value = 0.20;
    document.getElementById('localEduRegRatio').value = 20.0;
    document.getElementById('brokerage').value = 0.60;
    document.getElementById('minorFees').value = 200000;
    document.getElementById('homeBear').value = 2;
    document.getElementById('homeBase').value = 3.5;
    document.getElementById('homeBull').value = 5;
    document.getElementById('qqqBear').value = 8.00;
    document.getElementById('qqqBase').value = 12.00;
    document.getElementById('qqqBull').value = 15.00;
    document.getElementById('includeBuyerCosts').checked = true;
    document.getElementById('includeRenewalJumps').checked = true;
    document.getElementById('useHarvest').checked = true;
    render();
  });
}

function toggleCollapsible(id) {
  const content = document.getElementById(id + 'Content');
  const chevron = document.getElementById(id + 'Chevron');
  
  if (content.classList.contains('expanded')) {
    content.classList.remove('expanded');
    chevron.classList.remove('rotated');
    chevron.textContent = 'â–¼';
  } else {
    content.classList.add('expanded');
    chevron.classList.add('rotated');
    chevron.textContent = 'â–²';
  }
}

// ë¸Œë¼ìš°ì € í­ì— ë”°ë¥¸ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ë™ì  ì¡°ì •
function adjustTableLayout() {
  const currentWidth = window.innerWidth;
  const isMobileDevice = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  
  // ì¢ì€ í™”ë©´ ì¡°ê±´: 768px ì´í•˜ OR ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤
  const isNarrow = currentWidth <= 768 || isMobileDevice;
  
  // í´ë˜ìŠ¤ ì ìš©
  if (isNarrow) {
    document.body.classList.add('narrow-view');
  } else {
    document.body.classList.remove('narrow-view');
  }
  
  // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ë„ ì¶”ê°€
  if (isMobileDevice) {
    document.body.classList.add('mobile-device');
  } else {
    document.body.classList.remove('mobile-device');
  }
  
  // í„°ì¹˜ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ë„ ì¶”ê°€
  if (isTouchDevice) {
    document.body.classList.add('touch-device');
  } else {
    document.body.classList.remove('touch-device');
  }
  
  console.log(`
ğŸ“± ë””ë°”ì´ìŠ¤ ì •ë³´:
- ë¸Œë¼ìš°ì € í­: ${currentWidth}px
- ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤: ${isMobileDevice}
- í„°ì¹˜ ì§€ì›: ${isTouchDevice}
- ì¢ì€ í™”ë©´ ëª¨ë“œ: ${isNarrow}
- ì ìš©ëœ í´ë˜ìŠ¤: ${document.body.className}
  `);
}

// ì´ˆê¸° ì‹¤í–‰ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
adjustTableLayout();
window.addEventListener('resize', adjustTableLayout);
window.addEventListener('orientationchange', () => {
  setTimeout(adjustTableLayout, 100); // ë°©í–¥ ë³€ê²½ í›„ ì•½ê°„ì˜ ì§€ì—°
});

// ê¸°ë³¸ì ì¸ ì†ŒìŠ¤ ë³´í˜¸
(function() {
  // ê°œë°œì ë„êµ¬ ë‹¨ì¶•í‚¤ ë°©ì§€
  document.addEventListener('keydown', function(e) {
    // F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U ë“± ì°¨ë‹¨
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
        (e.ctrlKey && e.key === 'u')) {
      e.preventDefault();
      console.clear();
      return false;
    }
  });
  
  // ì½˜ì†” ê²½ê³  ë©”ì‹œì§€
  console.clear();
  console.log('%câš ï¸ ê²½ê³ ', 'color: red; font-size: 20px; font-weight: bold;');
  console.log('%cì´ ë„êµ¬ëŠ” ê°œì¸ì ì¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.\nì†ŒìŠ¤ì½”ë“œì˜ ë¬´ë‹¨ ë³µì œ ë° ë°°í¬ë¥¼ ê¸ˆì§€í•©ë‹ˆë‹¤.', 'color: orange; font-size: 14px;');
})();

// ë¸Œë¼ìš°ì € í­ì— ë”°ë¥¸ í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ë™ì  ì¡°ì •
function adjustTableLayout() {
  const currentWidth = window.innerWidth;
  const isMobileDevice = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
  
  // ì¢ì€ í™”ë©´ ì¡°ê±´: 768px ì´í•˜ OR ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤
  const isNarrow = currentWidth <= 768 || isMobileDevice;
  
  // í´ë˜ìŠ¤ ì ìš©
  if (isNarrow) {
    document.body.classList.add('narrow-view');
  } else {
    document.body.classList.remove('narrow-view');
  }
  
  // ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ë„ ì¶”ê°€
  if (isMobileDevice) {
    document.body.classList.add('mobile-device');
  } else {
    document.body.classList.remove('mobile-device');
  }
  
  // í„°ì¹˜ ë””ë°”ì´ìŠ¤ í´ë˜ìŠ¤ë„ ì¶”ê°€
  if (isTouchDevice) {
    document.body.classList.add('touch-device');
  } else {
    document.body.classList.remove('touch-device');
  }
  
  console.log(`
ğŸ“± ë””ë°”ì´ìŠ¤ ì •ë³´:
- ë¸Œë¼ìš°ì € í­: ${currentWidth}px
- ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤: ${isMobileDevice}
- í„°ì¹˜ ì§€ì›: ${isTouchDevice}
- ì¢ì€ í™”ë©´ ëª¨ë“œ: ${isNarrow}
- ì ìš©ëœ í´ë˜ìŠ¤: ${document.body.className}
  `);
}

// ì´ˆê¸° ì‹¤í–‰ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
adjustTableLayout();
window.addEventListener('resize', adjustTableLayout);
window.addEventListener('orientationchange', () => {
  setTimeout(adjustTableLayout, 100); // ë°©í–¥ ë³€ê²½ í›„ ì•½ê°„ì˜ ì§€ì—°
});

bind();
render();
</script>
</body>
</html>